# =============================================================================
# Nexbot Configuration Example
# =============================================================================
# Скопируйте этот файл в config.toml и настройте под ваши нужды.
#
# Подробная документация: docs/CONFIGURATION.md
# =============================================================================

# -----------------------------------------------------------------------------
# Workspace Settings
# -----------------------------------------------------------------------------
# Директория workspace хранит bootstrap файлы, логи и другие данные агента.
[workspace]
# Путь к директории workspace (поддерживает ~ и переменные окружения)
path = "~/.nexbot"

# Максимальное количество символов для чтения из bootstrap файлов
bootstrap_max_chars = 20000

# -----------------------------------------------------------------------------
# Agent Settings
# -----------------------------------------------------------------------------
# Настройки поведения агента и параметров модели.
[agent]
# LLM провайдер: "zai" или "openai"
provider = "zai"

# Модель по умолчанию для запросов к LLM
model = "glm-4.7-flash"

# Максимум токенов в ответе LLM
max_tokens = 8192

# Максимум итераций tool calling на запрос
max_iterations = 20

# Temperature для сэмплинга LLM (0.0 - 1.0)
temperature = 0.7

# Таймаут обработки запроса агента (включая tool calls)
timeout_seconds = 60

# -----------------------------------------------------------------------------
# LLM Provider Settings
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Z.ai Provider Settings
# -----------------------------------------------------------------------------
# Конфигурация LLM провайдера Z.ai.
[llm.zai]
# API ключ Z.ai (используйте переменные окружения для безопасности)
# Получите ключ на https://z.ai
api_key = "${ZAI_API_KEY:}"

# Base URL Z.ai API
base_url = "https://api.z.ai/api/coding/paas/v4"

# Таймаут HTTP запросов к Z.ai API
timeout_seconds = 60

# -----------------------------------------------------------------------------
# OpenAI Provider Settings (Optional)
# -----------------------------------------------------------------------------
# Раскомментируйте для использования OpenAI вместо Z.ai.
# [llm.openai]
# api_key = "${OPENAI_API_KEY:}"
# base_url = "https://api.openai.com/v1"

# -----------------------------------------------------------------------------
# Telegram Channel Settings
# -----------------------------------------------------------------------------
# Конфигурация канала Telegram.
[channels.telegram]
# Включить канал Telegram
enabled = true

# Токен Telegram бота (получите у @BotFather)
token = "${TELEGRAM_BOT_TOKEN:}"

# Список разрешённых Telegram user ID (пусто = разрешить всем)
# Узнайте свой ID через @userinfobot
allowed_users = []

# Список разрешённых Telegram chat ID (пусто = разрешить всем)
allowed_chats = []

# Таймаут для отправки сообщений (в секундах)
send_timeout_seconds = 5

# Редактирование сообщений (inline mode)
enable_inline_updates = true

# Parse mode по умолчанию: "markdown", "html", "none"
default_parse_mode = "markdown"

# Inline keyboards поддержка
enable_inline_keyboard = true

# Тихий режим (без уведомлений пользователя)
quiet_mode = false

# Таймаут для ответа на callback queries (в секундах)
answer_callback_timeout = 5

# -----------------------------------------------------------------------------
# File Tools Settings
# -----------------------------------------------------------------------------
# Конфигурация инструментов работы с файлами.
[tools.file]
# Включить операции с файлами (read_file, write_file, list_dir)
enabled = true

# Список директорий, где разрешены операции с файлами
# Пустой список = операции с файлами запрещены
whitelist_dirs = ["~/.nexbot", "~/projects", "~/Documents"]

# Список директорий только для чтения
read_only_dirs = ["/etc", "/usr", "/bin"]

# -----------------------------------------------------------------------------
# Shell Tools Settings
# -----------------------------------------------------------------------------
# Конфигурация инструментов работы с shell.
[tools.shell]
# Включить выполнение shell команд
enabled = true

# Список разрешённых shell команд (пусто = shell отключён)
# Добавляйте только безопасные команды
allowed_commands = ["ls", "cat", "grep", "find", "cd", "pwd", "echo", "date", "git"]

# Список запрещённых shell команд (заблокированы независимо от allowed)
deny_commands = ["rm", "rmdir", "dd", "mkfs", "fdisk", "shutdown"]

# Список команд, требующих подтверждения пользователя
# Используйте "*" для подкоманд (например, "git *" для всех команд git)
ask_commands = ["git *", "docker *"]

# Таймаут выполнения shell команды
timeout_seconds = 30

# -----------------------------------------------------------------------------
# Fetch Tool Settings
# -----------------------------------------------------------------------------
# Конфигурация инструмента загрузки веб-страниц.
[tools.fetch]
# Включить загрузку контента по URL
enabled = false

# Таймаут HTTP запроса (в секундах)
timeout_seconds = 30

# Максимальный размер ответа (в байтах, по умолчанию 5MB)
max_response_size = 5242880

# User-Agent для HTTP запросов
user_agent = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"

# -----------------------------------------------------------------------------
# Cron Scheduler Settings
# -----------------------------------------------------------------------------
# Конфигурация планировщика задач (v0.2+).
[cron]
# Включить cron планировщик
enabled = true

# Часовой пояс для планирования задач
timezone = "UTC"

# -----------------------------------------------------------------------------
# Worker Pool Settings
# -----------------------------------------------------------------------------
# Конфигурация пула async задач (v0.2+).
[workers]
# Количество worker goroutines
pool_size = 5

# Ёмкость очереди для ожидающих задач
queue_size = 100

# -----------------------------------------------------------------------------
# Subagent Manager Settings
# -----------------------------------------------------------------------------
# Конфигурация управления subagents (v0.2+).
[subagent]
# Включить функциональность subagent
enabled = true

# Максимум одновременных subagents
max_concurrent = 10

# Таймаут по умолчанию для задач subagent
timeout_seconds = 300

# Префикс для session ID subagent
session_prefix = "subagent-"

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
# Конфигурация логирования.
[logging]
# Уровень логирования: "debug", "info", "warn", "error"
level = "info"

# Формат логов: "json" или "text"
format = "json"

# Вывод логов: "stdout", "stderr", или путь к файлу
# Для вывода в файл: output = "~/.nexbot/nexbot.log"
output = "stdout"

# -----------------------------------------------------------------------------
# Message Bus Settings
# -----------------------------------------------------------------------------
# Конфигурация системы очередей сообщений.
[message_bus]
# Ёмкость очереди для входящих/исходящих сообщений
capacity = 1000

# Ёмкость канала для результатов выполнения задач
result_channel_capacity = 500

# Включить приоритетную обработку результатов
enable_high_priority_results = true

# -----------------------------------------------------------------------------
# Docker Subagent Settings
# -----------------------------------------------------------------------------
# Конфигурация Docker-изоляции для сабагентов (v0.17+).
[docker]
# Включить Docker-изоляцию сабагентов
enabled = true

# Политика загрузки образов: always, if-not-present, never
pull_policy = "if-not-present"

# Таймаут выполнения задачи (в секундах)
task_timeout_seconds = 300

# Путь к subagent prompts для монтирования
subagent_prompts_path = "~/.nexbot/subagent"

# Путь к skills директории для монтирования
skills_mount_path = "~/.nexbot/skills"

# Путь к бинарному файлу (опционально, по умолчанию os.Executable())
# Для Docker на macOS с ARM64: build-linux-arm64 и укажите путь к нему
# binary_path = "/path/to/nexbot/bin/nexbot-linux-arm64"

# Лимит памяти (например: 128m, 256m, 1g)
memory_limit = "128m"

# Лимит CPU (0.5 = половина ядра)
cpu_limit = 0.5

# Лимит процессов
pids_limit = 50

# Docker security options
security_opt = ["no-new-privileges"]

# Read-only root filesystem
readonly_rootfs = false

# Переменная окружения с API ключом для LLM
llm_api_key_env = "ZAI_API_KEY"

# Rate limiting: максимум задач в минуту
max_tasks_per_minute = 60

# Circuit breaker: порог ошибок до открытия
circuit_breaker_threshold = 5

# Circuit breaker: таймаут в секундах
circuit_breaker_timeout_seconds = 30

# Интервал health check (в секундах)
health_check_interval_seconds = 30

# Максимум pending задач на контейнер
max_pending_per_container = 100

# TTL для inspect кэша (в секундах)
inspect_ttl_seconds = 5

# TTL для secrets (в секундах)
secrets_ttl_seconds = 300

# =============================================================================
# Примеры использования переменных окружения:
# =============================================================================
# export ZAI_API_KEY="zai-ваш-api-ключ"
# export TELEGRAM_BOT_TOKEN="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
#
# Добавьте в ~/.bashrc или ~/.zshrc для постоянного использования:
# echo 'export ZAI_API_KEY="zai-ваш-api-ключ"' >> ~/.bashrc
# echo 'export TELEGRAM_BOT_TOKEN="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"' >> ~/.bashrc
# source ~/.bashrc
# =============================================================================
